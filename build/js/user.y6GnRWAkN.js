(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var l in i)e.o(i,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:i[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=jQuery;var i=e.n(t);i()(document).ready((function(){const e="salary_bank_account_information",t="iban",l="debit_card";let n=i()(`#${e}_repeat`),a=i()(`#${e}_repeat .cmb-add-group-row`);PMPRTrigger.addAction("pr_foundation_form_group_added",((t,l)=>{if(t.is(`[data-field-id="${e}"]`)){let n="",r=PMPRAdminUtil.getFieldById(e,i()(l.target));!r||PMPRUtil.isEmpty(r)||s(r.not(":last"))||(t.remove(),n=PMPRUtil.getSettingByPath("messages.invalid.add_new"));let c=a.parent();c.find(".msg").remove(),PMPRUtil.isEmpty(n)||c.append(n)}})),PMPRTrigger.addFilter("pr_foundation_form_validation",((t,l)=>{if(l.is("#your-profile")&&t){let l=PMPRAdminUtil.getFieldById(e);l&&l.length>1&&(t=s(l),t||i()("#tab_incomes_and_payments").get(0).click())}return t})),i()(document).on("input paste keyup",".card-value, .iban-value",(e=>{let t=i()(e.target),n=t.closest(".inside"),a=n.find("select.account-type").value;!function(e,t,i=l){let n=e.find("select.bank-name"),a=PMPRAdminUtil.removeWhitespace(t.val());n.parent().removeClass("blocking");let r=c(a,i);if(!PMPRUtil.isEmpty(r)){n.val()!==r&&(n.val(r),n.trigger("change")),n.parent().addClass("blocking")}}(n,t,a)}));let r=PMPRAdminUtil.getFieldById(e,n);function c(e,i){let n=0,a=0,r=!1;switch(i){case t:n=4,a=7;break;case l:n=0,a=6}if(a>0&&e.length>=a){r=PMPRUtil.getSettingByPath(`prefixes.${i}`)[e.substring(n,a)]}return r}function o(e){let t=!1;if(26===e.length&&/IR[0-9]{24}/.test(e)){let i=e.substr(4),l=e.charCodeAt(0)-65+10,n=e.charCodeAt(1)-65+10;i+=l.toString()+n.toString()+e.substr(2,2),t=1===function(e){let t,i=e;for(;i.length>2;)t=i.slice(0,9),i=parseInt(t,10)%97+i.slice(t.length);return parseInt(i,10)%97}(i)}return t}function s(e){let n=!0,a=[];if(!PMPRUtil.isEmpty(e)){let r=PMPRUtil.getSettingByPath("messages");e.each(((e,s)=>{let d=i()(s),u=d.find("select.account-type").val(),P={owner:{selector:".account-owner",callback:e=>e.length>6},bank:{selector:"select.bank-name",callback:e=>!PMPRUtil.isEmpty(e)},debit_card:{selector:".card-value",callback:e=>{let t=!0;return u===l&&(t=function(e){let t=!1;if(e.length>=16){let i,l,n=0;for(let t=0;t<16;t++)i=t%2==0?2:1,l=parseInt(e.substr(t,1))*i,n+=l>9?l-9:l;t=n%10==0}return t}(e),t&&a.push(e)),t}},iban:{selector:".iban-value",callback:e=>{let i=!0;return u===t&&(i=o(e),i&&a.push(e)),i}}};i().each(P,((e,{selector:i,callback:o})=>{let s=d.find(i);if(!PMPRUtil.isEmpty(s)){let i=PMPRAdminUtil.removeWhitespace(s.val()),d=!0;if(PMPRUtil.inArray(e,[t,l])){let t=c(i,e);i.length>0&&!t?(d=!1,e="bank_not_detected"):PMPRUtil.inArray(i,a)&&(d=!1,e="duplicate_specification")}if(d=d&&o(i),!d){let t=r.invalid[e];PMPRUtil.isEmpty(t)||PMPRUtil.invalidInput(s,t),n=!1}}}))}))}return n}r&&!PMPRUtil.isEmpty(r)&&r.each(((t,l)=>{let n=i()(l),a=i()(`input#${e}_${t}_locked`);PMPRUtil.isEmpty(a)||1!==parseInt(a.val())||(n.addClass("blocking"),n.find(".cmb-remove-group-row").remove())}))}))})();